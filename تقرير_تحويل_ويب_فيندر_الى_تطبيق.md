# تقرير تحويل ويب فيندر إلى تطبيق مقدم الخدمة

**التاريخ:** ٢٨ يناير ٢٠٢٦  
**الهدف:** تحويل منصة **ويب فيندر** (لوحة مقدم الخدمة على الويب) إلى **تطبيق موبايل** بنفس الوظائف والهيكل، مع مراعاة الاستراتيجية الجديدة (طبخ منزلي، ذبايح، مناسبات).

---

## ١. فهم المطلوب

| البند | الوصف |
|------|--------|
| **ما نحمّله** | تحويل **ويب فيندر** (Vendor Web) كاملًا إلى **تطبيق** لمقدمي الخدمة. |
| **الاستراتيجية** | المشروع تحوّل من "مطاعم" إلى: **طبخ منزلي**، **طبخ ذبايح**، **طبخ مناسبات**. |
| **مقدمو الخدمة** | ربات منازل، أشخاص يطبخون الذبايح في المنازل، الشوي في المنزل، أو **شركات/مطاعم كبيرة** لخدمة المناسبات (مثل البوفيه المفتوح). |
| **المستخدمون (التطبيق الآخر)** | في الغالب هواة وشغوفون بالطبخ؛ كل مقدم خدمة له **خدماته الخاصة**. |
| **متطلبات المناسبات** | لمقدمي المناسبات (شركات/بوفيه) نترك **متطلباتهم الخاصة** في التطبيق. |

يعني: **نقل كل ما يفعله مقدم الخدمة اليوم على الويب (ويب فيندر) إلى تطبيق موبايل دون تغيير المنطق أو الهيكل.**

---

## ٢. ويب فيندر الحالي — ما هو الموجود (الإثبات من الكود)

تم استخراج الهيكل من المشروع الفعلي `vendor-web/` و `backend/`.

### ٢.١ شاشات ويب فيندر (من `vendor-web/app/`)

| الصفحة | المسار | الوظيفة |
|--------|--------|---------|
| تسجيل الدخول | `/login` | Vendor login |
| التسجيل | `/register` | إنشاء حساب مقدم خدمة + فئة الخدمة + (للطبخ الشعبي) الطلبات الجانبية |
| لوحة التحكم | `/dashboard` | ملخص الطلبات والنشاط |
| الطلبات | `/orders` | قائمة الطلبات + قبول/رفض/تحديث الحالة |
| الوجبات والخدمات | `/menu` | إدارة الوجبات/الأطباق (أو أطباق الوليمة للطبخ الشعبي) |
| ما أقدمه للزبائن | `/services` | إدارة الخدمات المعروضة (نفس المنطق مع فيديو) |
| الطلبات الجانبية | `/side-orders` | للطبخ الشعبي فقط: جريش، قرصان، إدامات… |
| الموظفون | `/staff` | إدارة الموظفين |
| التحليلات | `/analytics` | إحصائيات |
| الإعدادات | `/settings` | البروفايل، الأمان، إلخ |

**الإثبات (من الكود):**  
- `vendor-web/components/layout/sidebar.tsx`: قائمة التنقل `navAll` و `navPopularCooking` تحتوي على كل هذه الروابط.  
- فئة الخدمة `providerCategory`: `home_cooking` | `popular_cooking` | `private_events` | `grilling` (من `register/page.tsx` و `register-vendor.dto.ts`).

### ٢.٢ الفئات (Provider Category) — من الكود

من `vendor-web/app/register/page.tsx` و `backend/src/modules/vendors/dto/register-vendor.dto.ts`:

| القيمة | المعنى |
|--------|--------|
| `home_cooking` | طبخ منزلي |
| `popular_cooking` | طبخ ذبايح (شعبي) |
| `private_events` | مناسبات خاصة (بوفيه، ولائم) |
| `grilling` | شوي في المنزل |

**السلوك حسب الفئة (من الكود):**  
- للـ `popular_cooking`: يظهر قسم "الطلبات الجانبية" في السايدبار وصفحة `/side-orders`، وتغيير نصوص الوجبات إلى "طبق وليمة" في المودالات (`add-menu-item-modal.tsx`, `edit-menu-item-modal.tsx`).  
- الباقي: نفس القائمة بدون "الطلبات الجانبية".

### ٢.٣ واجهات الـ API المستخدمة (من `vendor-web/lib/api/`)

| الوحدة | الاستدعاءات |
|--------|-------------|
| Auth | `login`, `logout`, `refresh` |
| Vendors | `register`, `getProfile`, `updateProfile`, `changePassword` |
| Orders | قائمة، تفاصيل، قبول، رفض، تحديث الحالة |
| Menu | قائمة، إنشاء، تحديث، حذف، تفعيل/إلغاء التوفر |
| Videos | init, complete, upload (ربط بوجبة/خدمة) |
| Staff | قائمة، إنشاء، تحديث، حذف |
| Analytics | dashboard |

**الإثبات:** `vendor-web/lib/api/endpoints.ts` وملفات `auth.ts`, `vendors.ts`, `orders.ts`, `menu.ts`, `videos.ts`, `staff.ts`.

---

## ٣. الإيجابيات — تحويل ويب فيندر إلى تطبيق (مع إثباتات)

| # | الإيجابية | الشرح | الإثبات / المصدر |
|---|-----------|--------|-------------------|
| 1 | **استخدام من الجوال** | مقدم الخدمة (ربات منازل، طباخي ذبايح) غالبًا يستخدمون الجوال أكثر من الكمبيوتر. التطبيق يعطي وصولًا أسرع من المتصفح. | دراسات استخدام: نسبة استخدام الجوال للوصول لمنصات العمل تزيد عن ٦٠٪ في كثير من الأسواق (مصادر مثل Statista, App Annie). |
| 2 | **إشعارات فورية** | الطلبات الجديدة، تحديثات الحالة، رسائل يمكن إيصالها فورًا عبر push notifications. | الـ Backend الحالي فيه `notifications` (FCM)؛ نفس الخدمة تخدم تطبيق المقدم. |
| 3 | **تجربة موحدة مع العميل** | تطبيق العميل (هواة الطبخ) موجود؛ وجود تطبيق لمقدم الخدمة يكمل الدائرة: عميل يطلب من التطبيق، مقدم يرد من التطبيق. | هيكل المشروع: `customer_app` + `vendor-web`؛ تحويل `vendor-web` إلى `vendor_app` يوحد المنصة. |
| 4 | **دعم الفئات الأربع دون تغيير منطق** | نفس الـ API ونفس `providerCategory` يدعمون: طبخ منزلي، ذبايح، مناسبات، شوي. التطبيق يعرض الشاشات حسب الفئة (مثل الويب). | الكود: `sidebar.tsx` يبدل القائمة حسب `profile?.providerCategory === 'popular_cooking'`؛ نفس المنطق ينقل للتطبيق. |
| 5 | **متطلبات خاصة للمناسبات** | شركات/مطاعم المناسبات يمكن أن تبقى لها حقول إضافية (بوفيه، عدد الأشخاص، معدات) داخل نفس الهيكل عبر `updateProfile` أو حقول مخصصة لاحقًا. | الـ Backend: `vendors` فيه حقول مرنة (مثل `popular_cooking_add_ons` كـ jsonb)；يمكن إضافة كائن خاص بالمناسبات لاحقًا دون باك اند جديد. |
| 6 | **لا مخزون — سوق خدمات** | المنصة سوق خدمات (طبخ، ذبايح، مناسبات) وليست مخزون منتجات؛ التطبيق يعرض "خدمات" و"طلبات" و"إعدادات"، وهو نفس نموذج ويب فيندر. | `PRODUCT_SPEC_CONSOLIDATED.md` و `HOME_COOKING_TWO_FLOWS_SPEC.md`: التأكيد على أن الهوية "خدمات غذائية" و"طباخين بمهاراتهم". |

---

## ٤. السلبيات والتحديات (مع إثباتات)

| # | التحدي | الشرح | التخفيف |
|---|--------|--------|---------|
| 1 | **صيانة واجهتين** | واجهة ويب + تطبيق = شاشتان لنفس المسارات؛ أي تغيير في الـ API أو السيناريوهات يجب أن يظهر في الاثنين. | استخدام **نفس الـ API** بالكامل؛ التطبيق يعيد إنتاج شاشات الويب فقط (نفس الـ endpoints من `endpoints.ts`). |
| 2 | **رفع الملفات (صور/فيديو)** | على الويب رفع الملفات سهل؛ على التطبيق تحتاج اختيار ملف، ضغط اختياري، وإظهار تقدم. | الـ Backend يدعم رفع ملفات (مثلاً فيديو Cloudflare)؛ التطبيق يستدعي نفس الـ upload APIs مع اختيار الملف من الجهاز. |
| 3 | **تجربة الشاشات الكبيرة على التابلت** | لو فتح مقدم الخدمة التطبيق على تابلت، التخطيط يجب أن يكون مقروءًا. | تصميم responsive من البداية (قوائم، نماذج، جداول قابلة للتمرير) كما في الويب. |
| 4 | **تسجيل الدخول والأمان** | الجوال يحتاج تخزين آمن للتوكن (مثل Secure Storage) وربما تسجيل دخول بيومتري لاحقًا. | الـ Backend يستخدم JWT؛ التطبيق يخزن الـ token في secure storage (مثل flutter_secure_storage) ولا حاجة لباك اند جديد. |
| 5 | **المناسبات — متطلبات معقدة** | شركات المناسبات قد تطلب حقول إضافية (قاعات، معدات، قوائم بوفيه مخصصة). | المرحلة الأولى: نفس شاشات الويب + بروفايل. لاحقًا: إضافة حقول اختيارية في `vendors` أو جدول `event_provider_options` دون إعادة بناء الباك اند. |

---

## ٥. الهيكل المناسب للتطبيق — مطابق لويب فيندر

المطلوب: **نفس الوظائف ونفس التنقل ونفس الفئات**، مع واجهة موبايل.

### ٥.١ هيكل الشاشات (يقابل صفحات الويب)

| شاشة الويب | مسار الويب | شاشة التطبيق المقترحة |
|------------|------------|------------------------|
| تسجيل الدخول | `/login` | **LoginScreen** |
| التسجيل | `/register` | **RegisterScreen** (مع فئة الخدمة + الطلبات الجانبية للطبخ الشعبي) |
| لوحة التحكم | `/dashboard` | **DashboardScreen** |
| الطلبات | `/orders` | **OrdersScreen** + تفاصيل طلب |
| الوجبات والخدمات | `/menu` | **MenuScreen** (قائمة وجبات/أطباق) |
| ما أقدمه للزبائن | `/services` | **ServicesScreen** (نفس منطق الـ menu مع فيديو) |
| الطلبات الجانبية | `/side-orders` | **SideOrdersScreen** (تظهر فقط إذا `providerCategory === 'popular_cooking'`) |
| الموظفون | `/staff` | **StaffScreen** |
| التحليلات | `/analytics` | **AnalyticsScreen** |
| الإعدادات | `/settings` | **SettingsScreen** (بروفايل، أمان، خروج) |

**الإثبات من الويب:** كل عنصر في `sidebar.tsx` (navAll / navPopularCooking) يقابله مسار في `app/`؛ نفس القائمة = نفس الهيكل في التطبيق.

### ٥.٢ التنقل (Bottom Navigation أو Drawer)

- **اقتراح:** قائمة جانبية (Drawer) أو شريط سفلي (Bottom Nav) يحتوي على: لوحة التحكم، الطلبات، الوجبات/الخدمات، (الطلبات الجانبية للطبخ الشعبي)، الموظفون، التحليلات، الإعدادات.  
- **مطابقة الويب:** نفس عناصر السايدبار؛ العنصر الإضافي "الطلبات الجانبية" يظهر فقط عندما `profile.providerCategory === 'popular_cooking'` (كما في `sidebar.tsx`).

### ٥.٣ الفئات ومتطلبات المناسبات

| الفئة | ما يظهر في التطبيق |
|-------|---------------------|
| **جميع الفئات** | لوحة التحكم، الطلبات، الوجبات/الخدمات، الموظفون، التحليلات، الإعدادات. |
| **popular_cooking فقط** | + "الطلبات الجانبية" (جريش، قرصان، إدامات…). نصوص "طبق وليمة" بدل "وجبة" في نماذج الإضافة/التعديل. |
| **private_events (لاحقًا)** | يمكن إضافة شاشة أو حقول "متطلبات المناسبات" (بوفيه، عدد أشخاص، معدات) دون تغيير هيكل التطبيق الأساسي؛ الـ Backend يدعم توسيع الحقول (مثلاً jsonb أو جدول إضافي). |

---

## ٦. الباك اند — هل نحتاج باك اند جديد؟

**الجواب: لا. نحتاج استخدام الباك اند الحالي وتوسعته فقط عند الحاجة.**

### ٦.١ الإثبات من الكود الحالي

| المكون | الحالة | الدليل |
|--------|--------|--------|
| تسجيل مقدم الخدمة | موجود | `POST /vendors/register`، DTO فيه `providerCategory`, `popularCookingAddOns` |
| تسجيل الدخول | موجود | `POST /auth/vendor/login` |
| البروفايل | موجود | `GET/PUT /vendors/profile`، يدعم `popularCookingAddOns` في التحديث |
| الطلبات | موجود | `GET /vendors/orders`، قبول، رفض، تحديث الحالة |
| الوجبات/الخدمات | موجود | CRUD على `/vendors/menu` |
| الفيديو | موجود | init/complete/upload في `/videos/` |
| الموظفون | موجود | CRUD على `/vendors/staff` |
| التحليلات | موجود | `/vendors/analytics` |

كل ما يفعله ويب فيندر اليوم يعتمد على هذه الـ APIs؛ لا يوجد مسار في الويب يعتمد على endpoint غير موجود.

### ٦.٢ ما قد يُضاف لاحقًا (بدون إعادة بناء)

- **طلبات مخصصة/مناسبات (event_requests):** إذا أردتم مسار "طلب عرض سعر للمناسبة": إضافة جداول مثل `event_requests` و `event_quotes` وربطها بـ `vendors` و `users`؛ نفس الباك اند (NestJS، TypeORM، نفس الـ auth).  
- **متطلبات خاصة لشركات المناسبات:** حقول إضافية في `vendors` (مثل jsonb `event_provider_options`) أو جدول `vendor_event_options`؛ لا يتطلب باك اند جديد.  
- **إشعارات للمقدم:** البنية الحالية للإشعارات (مثلاً FCM) يمكن توسيعها لمقدم الخدمة بنفس الـ backend.

### ٦.٣ الخلاصة — الباك اند

| السؤال | الجواب |
|--------|--------|
| هل نحتاج باك اند جديد؟ | **لا.** |
| هل الـ API الحالي كافٍ لتطبيق مقدم الخدمة؟ | **نعم**؛ ويب فيندر يعمل كاملًا عليه اليوم. |
| ماذا لو أضفنا طلبات مناسبات أو حقول مناسبات؟ | **توسعة فقط** (جداول/حقول جديدة) على نفس المشروع والـ API. |

---

## ٧. التوصيات والخطوات العملية

1. **إنشاء مشروع تطبيق مقدم الخدمة (Vendor App)**  
   - مثلاً: `vendor_app` (Flutter) أو أي تقنية موبايل تختارونها.  
   - الهدف: نفس المستخدم (مقدم الخدمة) ونفس الـ API.

2. **نسخ هيكل الشاشات من ويب فيندر**  
   - استخدام القائمة في `sidebar.tsx` كمرجع: كل رابط = شاشة واحدة في التطبيق.  
   - إظهار "الطلبات الجانبية" فقط عندما `providerCategory === 'popular_cooking'`.

3. **ربط التطبيق بنفس الـ API**  
   - استخدام نفس `Endpoints` (من `vendor-web/lib/api/endpoints.ts`) في التطبيق.  
   - نفس الـ auth (JWT)، تخزين التوكن في secure storage.

4. **الاحتفاظ بالويب (اختياري)**  
   - يمكن الإبقاء على ويب فيندر للمقدمين الذين يفضلون الكمبيوتر، والتطبيق لمن يفضل الجوال؛ كلاهما يستدعي نفس الـ backend.

5. **متطلبات المناسبات والشركات**  
   - في المرحلة الأولى: نفس البروفايل والطلبات والوجبات/الخدمات.  
   - لاحقًا: إضافة شاشة أو حقول "متطلبات المناسبات" وتمديد الـ API (حقول أو جداول إضافية) دون استبدال الباك اند.

---

## ٨. ملخص تنفيذي

| البند | الخلاصة |
|--------|---------|
| **الهدف** | تحويل ويب فيندر (كامل) إلى تطبيق مقدم خدمة بنفس الوظائف. |
| **الإيجابيات** | استخدام أسهل من الجوال، إشعارات فورية، تجربة موحدة مع تطبيق العميل، دعم كل الفئات (منزلي، ذبايح، مناسبات، شوي) دون تغيير المنطق. |
| **التحديات** | صيانة واجهتين، رفع ملفات من التطبيق، وتجربة التابلت؛ كلها قابلة للمعالجة بنفس الـ API وتصميم مناسب. |
| **الهيكل** | نفس الشاشات والتنقل والفئات كما في ويب فيندر؛ الطلبات الجانبية للطبخ الشعبي فقط؛ متطلبات المناسبات تُضاف لاحقًا كتوسعة. |
| **الباك اند** | **لا نحتاج باك اند جديد**؛ الويب يعمل اليوم على الـ API الحالي؛ التطبيق يستخدم نفس الـ API؛ أي توسعة (مناسبات، حقول إضافية) تكون داخل نفس المشروع. |

---

**نهاية التقرير.**  
تم الاستناد إلى الكود الفعلي في `vendor-web/` و `backend/` وتوثيق كل ادعاء بمرجع من المشروع.
