# خارطة العشرين مرحلة — إكمال تطبيق مقدم الخدمة وجاهزية النشر

**الهدف:** تقسيم الـ ١٨٩ ملفًا إلى ٢٠ مرحلة حسب الأولوية، مع ضمان عدم أخطاء/تحذيرات/انفو بعد كل مرحلة، واختبار على المحاكي كل ٥ مراحل، وربط فرونت اند وباك اند، وصولاً إلى تطبيق مكتمل وجاهز للنشر عند المرحلة ٢٠.

**تحديث (النسخة المنقحة):**

- **ربط Auth بدري:** ربط Auth الحقيقي (login/register، توكن، guards) يتم في **المرحلة ٧** مع ApiClient وInterceptors، وليس في المرحلة ١٧، حتى يُبنى Shell/Profile/Orders/Menu على تسجيل دخول حقيقي وتكون الاختبارات من المرحلة ١٠ على بيانات حية.
- **عقد API:** في **المرحلة ٨** يُنتج ملف `API_CONTRACT_VENDOR_APP.md` (مسارات + أمثلة request/response) قبل ربط كل الوحدات، لتقليل أخطاء DTO والويب/موبايل.
- **سياسة الشبكة (Offline/Retry):** في **المرحلة ٧** تُضاف `AppNetworkConfig` و`RetryPolicy` (عمليات حساسة = retry + idempotency؛ رفع ملفات = retry with backoff).
- **المرحلة ١٧:** تصبح "تقوية Auth" (refresh، logout، حالات أخطاء، pending/rejected من profile) بدل "ربط Auth لأول مرة".
- **المرحلة ١٨:** تكملة ربط بقية الوحدات بالباك اند (Auth مربوط مسبقًا).

**إجابات سريعة (مهمة):**

| السؤال | الجواب في الخارطة الحالية |
|--------|----------------------------|
| **هل التطبيق يدعم العربية والإنجليزية؟** | المرحلة ١٦ كانت "عربية فقط" (`strings_ar.dart`). تم توثيق دعم **ثنائي اللغة (عربي + إنجليزي)** في المرحلة ١٦: `strings_ar.dart` + `strings_en.dart` + اختيار اللغة (من الإعدادات أو أول تشغيل). |
| **هل لكل مقدم خدمة داشبورد خاص حسب ما يقدم؟** | **نعم، حسب نوع المقدم (providerCategory):** (١) **Shell/القائمة:** عناصر التنقل تختلف — مثلاً "الطلبات الجانبية" تظهر فقط لمقدمي **الطبخ الشعبي** (popular_cooking). (٢) **Dashboard:** شاشة واحدة لكن المحتوى يمكن أن يختلف حسب الفئة (إحصائيات الطلبات، الوجبات، الخدمات، الطلبات الجانبية…) حسب ما يقدمه المقدم. الباك اند يرجع بيانات الداشبورد حسب `vendorId` فكل مقدم يرى بياناته فقط. |

---

## قواعد العمل

| القاعدة | الوصف |
|--------|--------|
| **بعد كل مرحلة** | تشغيل `flutter analyze` — لا أخطاء، لا تحذيرات، لا info (أو توثيق استثناء مقبول). |
| **بعد المراحل ٥، ١٠، ١٥، ٢٠** | اختبار التطبيق على **المحاكي**: التأكد من الفرونت اند، الباك اند، والربط. |
| **الترتيب** | حسب الأولوية والاعتماديات: Core → Auth → Shell → Profile → Dashboard → Orders → Menu → Services → Side Orders → Staff → Analytics → Videos → Localization → ربط API → تحسينات → جاهزية النشر. |

---

## المرحلة ١ — الأساس والتشغيل (Foundation)

**الهدف:** التطبيق يفتح بدون crash، و`flutter analyze` نظيف.

**الملفات (تقريبًا ٢٥–٣٠ ملفًا):**

- `lib/main.dart` — تشغيل التطبيق مع `ProviderScope` و`MaterialApp`.
- `lib/app.dart` — `MaterialApp` مع theme وrouter أساسي.
- `core/config/` — `app_constants.dart`, `env.dart`, `flavor.dart`, `feature_flags.dart` (قيم افتراضية).
- `core/theme/` — `app_theme.dart`, `design_system.dart`, `dark_theme.dart` + `colors/` (app_colors, semantic_colors, gradient_colors) + `typography/` (text_styles, font_sizes, font_families) + `spacing/` (insets, gaps) + `shapes/` (radius, borders, card_shapes) + `icons/` (app_icons, icon_sizes) + `shadows/app_shadows.dart` + `components/` (button_theme, card_theme, input_theme, bottom_sheet_theme, cta_hierarchy) + `animations/` (curves, durations, transitions) + `accessibility/contrast_checker.dart`.
- `core/routing/` — `route_names.dart`, `guards.dart`, `app_router.dart` (مسارات: splash, login, register فقط).
- `core/errors/` — `failure.dart`, `app_exception.dart`, `error_handler.dart`, `error_mapper.dart`.
- `core/storage/` — `storage_keys.dart`, `secure_storage.dart`, `local_storage.dart` (واجهات/تنفيذ بسيط).
- `core/network/` — `endpoints.dart`, `network_exceptions.dart` (بدون استدعاءات فعلية).
- `core/di/` — `service_locator.dart`, `providers.dart` (تسجيل أساسي إن لزم).
- `core/utils/` — `logger.dart`, `validators.dart`, `formatters.dart`, `result.dart` (حد أدنى صالح).
- `core/widgets/` — `app_scaffold.dart`, `app_text_field.dart`, `primary_button.dart`, `loading_view.dart`, `empty_state.dart`, `error_state.dart` (widgetات فارغة أو placeholder تعيد `SizedBox` أو `Placeholder`).

**معيار النجاح:**  
`flutter analyze` = 0 errors, 0 warnings, 0 info. التطبيق يفتح ويعرض شاشة (مثلاً splash أو login placeholder).

---

## المرحلة ٢ — Auth: البيانات والنطاق (Data + Domain)

**الهدف:** طبقة Auth (data + domain) مكتملة وتحليل نظيف.

**الملفات:**

- `modules/auth/data/datasources/auth_remote_ds.dart`
- `modules/auth/data/models/login_request_dto.dart`, `login_response_dto.dart`, `register_vendor_dto.dart`
- `modules/auth/data/mappers/auth_mapper.dart`
- `modules/auth/data/repositories/auth_repo_impl.dart`
- `modules/auth/domain/entities/vendor_session.dart`
- `modules/auth/domain/repositories/auth_repo.dart`

**معيار النجاح:**  
`flutter analyze` نظيف. (ملفات `.g.dart` تُولَّد لاحقًا عند إضافة `@JsonSerializable`.)

---

## المرحلة ٣ — Auth: الحالة والشاشات (Presentation)

**الهدف:** شاشات Splash، Login، Register تعمل ويمكن التنقل بينها.

**الملفات:**

- `modules/auth/presentation/providers/auth_state.dart` (freezed إن استخدمتم).
- `modules/auth/presentation/providers/auth_notifier.dart`
- `modules/auth/presentation/screens/splash_screen.dart`, `login_screen.dart`, `register_screen.dart`

**معيار النجاح:**  
`flutter analyze` نظيف. التطبيق يعرض splash ثم login (أو register من زر).

---

## المرحلة ٤ — Bootstrap + Pending/Rejected + Session

**الهدف:** عند الفتح يتم التحقق من الجلسة؛ التوجيه إلى Login أو Pending أو Rejected أو Shell.

**الملفات:**

- `core/bootstrap/app_bootstrapper.dart`
- `modules/auth/presentation/providers/session_notifier.dart`
- `modules/auth/presentation/screens/pending_screen.dart`, `rejected_screen.dart`
- تحديث `app.dart` و`app_router.dart`: استخدام bootstrapper وسession للتوجيه، وإضافة مسارات `/pending`, `/rejected`.

**معيار النجاح:**  
`flutter analyze` نظيف. التطبيق يوجّه حسب حالة الجلسة (mock: غير مسجل → login، مسجل + pending → pending_screen، إلخ).

---

## المرحلة ٥ — Shell + Profile (أساس) + أول نقطة اختبار محاكي

**الهدف:** بعد تسجيل دخول (في المرحلة ٧ يصير حقيقيًا؛ هنا يمكن mock للتنقل فقط) يظهر Shell (Drawer أو Bottom Nav) مع لوحة التحكم كبداية.

**الملفات:**

- `modules/shell/presentation/screens/shell_screen.dart`
- `modules/shell/presentation/widgets/vendor_drawer.dart`, `vendor_bottom_nav.dart`
- `modules/profile/data/datasources/profile_remote_ds.dart`
- `modules/profile/data/models/vendor_profile_dto.dart`
- `modules/profile/data/mappers/profile_mapper.dart`
- `modules/profile/data/repositories/profile_repo_impl.dart`
- `modules/profile/domain/entities/vendor_profile.dart`
- `modules/profile/domain/repositories/profile_repo.dart`
- تحديث الـ router: مسار Shell، مسار Dashboard، والتوجيه بعد login إلى Shell.

**معيار النجاح:**  
`flutter analyze` نظيف. من شاشة Login (زر mock لتسجيل الدخول) الانتقال إلى Shell وعرض Dashboard (محتوى بسيط).

**نقطة اختبار محاكي (بعد المرحلة ٥):**

- فتح التطبيق على المحاكي.
- التأكد: Splash → Login → (بعد mock login) → Shell مع قائمة جانبية/سفلية → Dashboard.
- اختياري: طلب بسيط للباك اند (مثلاً health أو ping) للتأكد من الربط.

---

## المرحلة ٦ — Profile: الشاشات والإعدادات

**الهدف:** شاشات الإعدادات، تعديل البروفايل، وتغيير كلمة المرور قابلة للفتح من Shell.

**الملفات:**

- `modules/profile/presentation/providers/profile_notifier.dart`, `profile_state.dart`
- `modules/profile/presentation/screens/settings_screen.dart`, `edit_profile_screen.dart`, `change_password_screen.dart`
- `modules/profile/presentation/widgets/profile_header.dart`, `settings_tile.dart`
- تحديث الـ router وShell: روابط Settings، Edit Profile، Change Password.

**معيار النجاح:**  
`flutter analyze` نظيف. من Shell يمكن فتح الإعدادات وتعديل البروفايل وتغيير كلمة المرور (واجهة فقط إن لم يكن API جاهزًا).

---

## المرحلة ٧ — ApiClient + Interceptors + Auth الحقيقي + سياسة الشبكة + Dashboard

**الهدف:** ربط Auth بالباك اند **بدري** (تسجيل دخول/تسجيل حقيقي، توكن، guards)، ووجود عميل HTTP مع interceptors وسياسة retry، ولوحة التحكم تعرض بيانات (من API أو mock).

**لماذا بدري؟** بناء Shell/Profile/Orders/Menu على "mock login" ثم ربط Auth لاحقًا يسبب إعادة عمل كبير (session/token/refresh، Authorization header، guards، التوجيه). بجعل الربط هنا، من المرحلة ١٠ تكون الاختبارات على **بيانات حية**.

**الملفات:**

- **شبكة وسياسة إعادة المحاولة:**
  - `core/network/api_client.dart`
  - `core/network/interceptors/auth_interceptor.dart`, `error_interceptor.dart`, `logging_interceptor.dart`
  - `core/network/app_network_config.dart` أو `core/config/network_config.dart` — إعدادات baseUrl، timeouts.
  - `core/network/retry_policy.dart` — سياسة موحدة: عمليات حساسة (قبول/رفض/تحديث حالة طلب) = retry + idempotency key؛ غير حساسة (مثل تحديث التحليلات) = retry بسيط؛ رفع ملفات = retry with backoff أو resumable إن وُجد.
- **Auth الحقيقي:**
  - `modules/auth/data/datasources/auth_remote_ds.dart`: استدعاء `POST /auth/vendor/login`, `POST /vendors/register`.
  - `modules/auth/data/models/`: إضافة `@JsonSerializable` وتشغيل `build_runner` لـ `.g.dart`.
  - `modules/auth/data/repositories/auth_repo_impl.dart`: استخدام auth_remote_ds، حفظ التوكن في secure storage.
  - `core/bootstrap/app_bootstrapper.dart`: بعد التحقق من التوكن، جلب البروفايل (أو حالة الموافقة) والتوجيه: غير مسجل → login، pending → pending_screen، rejected → rejected_screen، approved → shell.
  - `modules/auth/presentation/providers/session_notifier.dart`: يعتمد على profile و`registration_status` من الباك اند.
  - تحديث `guards.dart` و`app_router.dart`: حماية مسارات Shell حسب التوكن وحالة الموافقة.
- **Dashboard (لكل مقدم خدمة بياناته فقط، والمحتوى حسب نوعه):**
  - `modules/dashboard/data/datasources/dashboard_remote_ds.dart`
  - `modules/dashboard/data/models/dashboard_stats_dto.dart`, `dashboard_mapper.dart`, `dashboard_repo_impl.dart`
  - `modules/dashboard/domain/entities/dashboard_stats.dart`, `dashboard_repo.dart`
  - `modules/dashboard/presentation/providers/dashboard_notifier.dart`, `dashboard_state.dart`
  - `modules/dashboard/presentation/screens/dashboard_screen.dart`
  - `modules/dashboard/presentation/widgets/stat_card.dart`, `orders_summary_card.dart`
  - الباك اند يرجع إحصائيات الداشبورد حسب `vendorId`؛ يمكن عرض بطاقات مختلفة حسب `providerCategory` (مثلاً طلبات جانبية لـ popular_cooking).
- تسجيل `api_client` و`dashboard_repo` و`auth_repo` في الـ DI.

**معيار النجاح:**  
`flutter analyze` نظيف. تسجيل دخول وتسجيل جديد **فعليان** عبر الباك اند؛ التوكن يُحفظ ويُرفق في الطلبات؛ التوجيه صحيح (login / pending / rejected / shell). Dashboard يعرض أرقامًا (من API أو mock).

---

## المرحلة ٨ — عقد API (API Contract) + Orders: البيانات والنطاق + Shared (Pagination)

**الهدف:** توحيد/تثبيت الـ DTOs والـ endpoints بين الموبايل والويب **قبل** ربط كل الوحدات، لتقليل أخطاء build_runner واختلاف التوقعات. ثم إكمال طبقة Orders (data + domain) ونماذج Pagination.

**١) عقد API (Deliverable واضح):**

- إنشاء ملف واحد داخل الـ repo: **`API_CONTRACT_VENDOR_APP.md`** (أو في جذر المشروع).
- المحتوى (سريع): مسارات الـ API + أمثلة request/response للـ Vendor App:
  - `POST /auth/vendor/login` — request/response.
  - `POST /vendors/register` — request/response.
  - `GET /vendors/profile`, `PUT /vendors/profile` — response/request.
  - `GET /vendors/orders`, `GET /vendors/orders/:id`, accept/reject/status — أمثلة.
  - `GET /vendors/menu`, CRUD, toggle availability.
  - `/vendors/services` إن وُجد endpoint منفصل، أو توضيح أنه نفس menu مع type.
  - `GET /vendors/staff`, CRUD.
  - `GET /vendors/analytics`.
  - `POST /videos/upload/init`, complete, upload.
- الهدف: مرجع واحد للفرونت اند والباك اند يقلل ~70% من أخطاء DTO والمسارات.

**٢) Orders + Shared:**

- `shared/enums/order_status.dart`
- `shared/models/paged_result.dart`, `api_meta.dart`
- `modules/orders/data/datasources/orders_remote_ds.dart`
- `modules/orders/data/models/order_dto.dart`, `order_item_dto.dart`
- `modules/orders/data/mappers/orders_mapper.dart`
- `modules/orders/data/repositories/orders_repo_impl.dart`
- `modules/orders/domain/entities/order.dart`, `order_item.dart`
- `modules/orders/domain/repositories/orders_repo.dart`

**معيار النجاح:**  
`flutter analyze` نظيف. وجود `API_CONTRACT_VENDOR_APP.md` مع المسارات وأمثلة request/response. طبقة Orders جاهزة مع pagination.

---

## المرحلة ٩ — Orders: الواجهة والتنقل

**الهدف:** قائمة الطلبات وتفاصيل الطلب تعملان من Shell.

**الملفات:**

- `modules/orders/presentation/providers/orders_notifier.dart`, `orders_state.dart`
- `modules/orders/presentation/providers/order_detail_notifier.dart`, `order_detail_state.dart`
- `modules/orders/presentation/screens/orders_screen.dart`, `order_detail_screen.dart`
- `modules/orders/presentation/widgets/order_tile.dart`, `order_status_chip.dart`, `order_actions_bar.dart`
- تحديث الـ router: `/orders`, `/orders/:id`.

**معيار النجاح:**  
`flutter analyze` نظيف. من Shell فتح الطلبات وتفاصيل طلب (بيانات mock أو API).

---

## المرحلة ١٠ — Menu كامل + ثاني اختبار محاكي

**الهدف:** شاشات الوجبات (قائمة، إضافة، تعديل) تعمل من Shell.

**الملفات:**

- `modules/menu/data/` (datasource, models, mapper, repo_impl)
- `modules/menu/domain/` (entity, repo)
- `modules/menu/presentation/` (notifier, state, menu_screen, add_menu_item_screen, edit_menu_item_screen, menu_item_tile, availability_switch)
- تحديث الـ router: `/menu`, `/menu/add`, `/menu/:id/edit`.

**معيار النجاح:**  
`flutter analyze` نظيف. قائمة الوجبات وإضافة/تعديل وجبة يعملان (واجهة + استدعاء API إن وُجد).

**نقطة اختبار محاكي (بعد المرحلة ١٠):**

- التنقل: Dashboard، Orders، Order Detail، Menu، Add/Edit Menu، Settings.
- التحقق من الفرونت اند لكل الشاشات المذكورة.
- **التحقق من الربط مع الباك اند على بيانات حية:** تسجيل دخول حقيقي (من المرحلة ٧)، طلبات، وجبات.

---

## المرحلة ١١ — Services كامل

**الهدف:** شاشات "ما أقدمه للزبائن" (قائمة، إضافة، تعديل) تعمل.

**الملفات:**

- `modules/services/data/` (datasource, models, mapper, repo_impl)
- `modules/services/domain/` (entity, repo)
- `modules/services/presentation/` (notifier, state, services_screen, add/edit_service_screen, service_item_tile)
- تحديث الـ router: `/services`, `/services/add`, `/services/:id/edit`.

**معيار النجاح:**  
`flutter analyze` نظيف. Services تعمل من Shell.

---

## المرحلة ١٢ — Side Orders (الطلبات الجانبية)

**الهدف:** شاشة الطلبات الجانبية تظهر في Shell لمقدمي الطبخ الشعبي فقط.

**الملفات:**

- `shared/enums/provider_category.dart` (إن لم يُضف سابقًا).
- `modules/side_orders/domain/entities/side_order_item.dart`
- `modules/side_orders/presentation/providers/side_orders_notifier.dart`, `side_orders_state.dart`
- `modules/side_orders/presentation/screens/side_orders_screen.dart`
- `modules/side_orders/presentation/widgets/side_order_tile.dart`, `add_side_order_form.dart`
- تحديث Shell/Drawer: إظهار "الطلبات الجانبية" فقط عندما `profile?.providerCategory == 'popular_cooking'`.
- تحديث الـ router: `/side-orders`.

**معيار النجاح:**  
`flutter analyze` نظيف. لمقدم popular_cooking يظهر عنصر الطلبات الجانبية وتفتح الشاشة (البيانات من profile أو updateProfile).

---

## المرحلة ١٣ — Staff كامل

**الهدف:** شاشات الموظفين (قائمة، إضافة، تعديل) تعمل.

**الملفات:**

- `modules/staff/data/` (datasource, models, mapper, repo_impl)
- `modules/staff/domain/` (entity, repo)
- `modules/staff/presentation/` (notifier, state, staff_screen, add/edit_staff_screen, staff_tile)
- تحديث الـ router: `/staff`, `/staff/add`, `/staff/:id/edit`.

**معيار النجاح:**  
`flutter analyze` نظيف. Staff تعمل من Shell.

---

## المرحلة ١٤ — Analytics كامل

**الهدف:** شاشة التحليلات تعرض بيانات (mock أو من API).

**الملفات:**

- `modules/analytics/data/` (datasource, models, mapper, repo_impl)
- `modules/analytics/domain/` (entity, repo)
- `modules/analytics/presentation/` (notifier, state, analytics_screen, chart_card, metric_row)
- تحديث الـ router: `/analytics`.

**معيار النجاح:**  
`flutter analyze` نظيف. Analytics تعمل من Shell.

---

## المرحلة ١٥ — Videos + Media + ثالث اختبار محاكي

**الهدف:** رفع الصور/الفيديو متاح من واجهة الوجبات أو الخدمات، ووحدة Media موحدة.

**الملفات:**

- `core/media/image_picker_service.dart`, `file_uploader.dart`
- `modules/videos/data/datasources/videos_remote_ds.dart`
- `modules/videos/data/repositories/videos_repo_impl.dart`
- `modules/videos/domain/repositories/videos_repo.dart`
- `modules/videos/presentation/widgets/video_picker_sheet.dart`
- ربط اختياري في add_menu_item / add_service: اختيار صورة أو فيديو ورفعها.

**معيار النجاح:**  
`flutter analyze` نظيف. يمكن اختيار صورة/فيديو من الجهاز (ورفعها إن الـ API جاهز).

**نقطة اختبار محاكي (بعد المرحلة ١٥):**

- التنقل بكل الشاشات: Auth، Shell، Dashboard، Orders، Menu، Services، Side Orders، Staff، Analytics، Settings.
- التحقق من الفرونت اند لكل المسارات.
- التحقق من الربط مع الباك اند: تسجيل دخول، بروفايل، طلبات، وجبات، خدمات، موظفون، تحليلات، طلبات جانبية (حسب API).

---

## المرحلة ١٦ — Localization (عربي + إنجليزي) + Feature Flags

**الهدف:** دعم **ثنائي اللغة (عربي + إنجليزي)** مع إمكانية تغيير اللغة، ونصوص موحدة، وأعلام ميزات (مثل إظهار/إخفاء الطلبات الجانبية) مدمجة.

**الملفات:**

- `core/localization/app_localizations.dart` — واجهة الترجمة ودعم `Locale` (ar / en).
- `core/localization/strings_ar.dart` — مفاتيح النصوص العربية.
- `core/localization/strings_en.dart` — مفاتيح النصوص الإنجليزية.
- حفظ اللغة المختارة (مثلاً في `local_storage`) وقراءتها عند التشغيل؛ خيار تغيير اللغة من الإعدادات (Settings).
- `core/config/feature_flags.dart` (استخدام من Shell وSide Orders).
- استبدال النصوص الثابتة في الشاشات الرئيسية بمفاتيح ترجمة (`AppLocalizations.of(context).stringKey`).
- `MaterialApp` (أو `app.dart`): دعم `locale` و`localizationsDelegates` و`supportedLocales: [Locale('ar'), Locale('en')]`.

**معيار النجاح:**  
`flutter analyze` نظيف. واجهة تدعم العربية والإنجليزية مع إمكانية التبديل؛ إظهار عناصر القائمة حسب feature flags و`providerCategory`.

---

## المرحلة ١٧ — تقوية Auth (Harden Auth)

**الهدف:** تحسين سلوك Auth بعد أن يكون الربط الأساسي قد تم في المرحلة ٧: refresh token، logout، حالات أخطاء، وpending/rejected من حالة البروفايل الحقيقية.

**الملفات (تحديثات):**

- **Refresh token:** عند 401، استدعاء `/auth/refresh` وتحديث التوكن وإعادة الطلب (في auth_interceptor أو في session_notifier).
- **Logout:** مسح التوكن من secure storage، إعادة التوجيه إلى login، وإلغاء أي طلبات معلقة إن لزم.
- **حالات أخطاء:** عرض رسائل واضحة عند فشل تسجيل الدخول أو التسجيل (شبكة، بيانات غير صحيحة، حساب مرفوض).
- **Pending/Rejected من البروفايل:** التأكد أن `session_notifier` و`app_bootstrapper` يعتمدان على `registration_status` أو ما يعادله من GET profile؛ التوجيه إلى pending_screen أو rejected_screen مع سبب الرفض من الباك اند إن وُجد.

**معيار النجاح:**  
`flutter analyze` نظيف. تجربة Auth مستقرة: refresh، logout، ورسائل أخطاء ووضع pending/rejected صحيحة.

---

## المرحلة ١٨ — ربط بقية الوحدات بالباك اند (تكملة الربط)

**الهدف:** كل قوائم وتفاصيل وإنشاء وتحديث تعتمد على API الباك اند. (Auth والـ ApiClient والـ Interceptors وسياسة Retry مكتملة من المرحلة ٧؛ هنا نكمل Profile، Orders، Menu، Services، Staff، Analytics، Side Orders، Videos.)

**التحديثات:**

- **Profile:** GET/PUT `/vendors/profile` (بما فيها `popularCookingAddOns` للطلبات الجانبية).
- **Orders:** GET `/vendors/orders`, GET `/vendors/orders/:id`, قبول/رفض/تحديث الحالة.
- **Menu:** CRUD `/vendors/menu`, toggle availability.
- **Services:** استخدام نفس menu API أو endpoint الخدمات حسب الباك اند.
- **Staff:** CRUD `/vendors/staff`.
- **Analytics:** GET `/vendors/analytics`.
- **Side Orders:** عبر `updateProfile` مع `popularCookingAddOns`.
- **Videos:** init/complete/upload حسب endpoints الباك اند.

**معيار النجاح:**  
`flutter analyze` نظيف. التطبيق يعمل مع الباك اند الحقيقي (بيانات حية).

---

## المرحلة ١٩ — إصلاح التحذيرات والانفو والتحسينات

**الهدف:** تحليل نظيف ١٠٠٪ (أو توثيق أي استثناء)، وتحسينات تجربة وسلوك.

**المهام:**

- تشغيل `flutter analyze` وإصلاح كل error / warning / info.
- مراجعة Pagination في الطلبات والوجبات (استخدام `paged_result` و`api_meta`).
- مراجعة رفع الصور/الفيديو وتقدّم الرفع.
- أي إصلاحات ناتجة عن اختبار المحاكي السابق.
- توثيق أي تحذير أو info مقبول مع السبب.

**معيار النجاح:**  
`flutter analyze` بدون أخطاء وتحذيرات (أو ملف `ANALYZE_EXCEPTIONS.md` يوثّق الاستثناءات).

---

## المرحلة ٢٠ — جاهزية النشر + رابع اختبار محاكي

**الهدف:** التطبيق مكتمل، مربوط، وجاهز لتقديمه للمتجر (أو للنشر الداخلي).

**المهام:**

- **أمان:** مراجعة تخزين التوكن (secure storage)، عدم تسريب بيانات حساسة في الـ logs.
- **نصوص وترجمة:** مراجعة كل النصوص المعروضة للمستخدم (عربي).
- **إصدار:** تحديث `version` و`buildNumber` في `pubspec.yaml` (أو في الـ CI).
- **قائمة التحقق:** لا مطاعم؛ الفئات واضحة (طبخ منزلي، ذبايح، مناسبات، شوي)؛ شاشات الموافقة (pending/rejected) تعمل؛ الربط مع الباك اند يعمل.
- **اختبار نهائي على المحاكي:** مسار كامل من فتح التطبيق → تسجيل دخول → التنقل في كل الشاشات → تنفيذ إجراء (طلب، وجبة، خدمة، طلب جانبي، موظف، إلخ) → تسجيل خروج أو إعدادات.

**معيار النجاح:**  
التطبيق يعمل من البداية للنهاية على المحاكي مع الباك اند، ولا توجد أخطاء أو تحذيرات تحليل، وجاهز لرفع بناء (build) للنشر.

---

## ملخص المراحل والاختبارات

| المرحلة | المحتوى المختصر | تحليل | اختبار محاكي |
|---------|------------------|--------|---------------|
| 1 | أساس + ثيم + routing + errors + storage + network + widgets | ✅ بعد 1 | — |
| 2 | Auth data + domain | ✅ بعد 2 | — |
| 3 | Auth presentation (splash, login, register) | ✅ بعد 3 | — |
| 4 | Bootstrap + session + pending/rejected | ✅ بعد 4 | — |
| 5 | Shell + Profile (أساس) | ✅ بعد 5 | ✅ **أول اختبار محاكي** |
| 6 | Profile شاشات (settings, edit, change password) | ✅ بعد 6 | — |
| 7 | **ApiClient + Interceptors + Auth الحقيقي + RetryPolicy + Dashboard** | ✅ بعد 7 | — |
| 8 | **عقد API (API_CONTRACT_VENDOR_APP.md) +** Orders data/domain + shared pagination | ✅ بعد 8 | — |
| 9 | Orders presentation | ✅ بعد 9 | — |
| 10 | Menu كامل | ✅ بعد 10 | ✅ **ثاني اختبار محاكي** |
| 11 | Services كامل | ✅ بعد 11 | — |
| 12 | Side Orders | ✅ بعد 12 | — |
| 13 | Staff كامل | ✅ بعد 13 | — |
| 14 | Analytics كامل | ✅ بعد 14 | — |
| 15 | Videos + Media | ✅ بعد 15 | ✅ **ثالث اختبار محاكي** |
| 16 | Localization (عربي + إنجليزي) + Feature flags | ✅ بعد 16 | — |
| 17 | **تقوية Auth (refresh, logout, أخطاء, pending/rejected من profile)** | ✅ بعد 17 | — |
| 18 | ربط بقية الوحدات بالباك اند (تكملة الربط) | ✅ بعد 18 | — |
| 19 | إصلاح تحذيرات/انفو + تحسينات | ✅ بعد 19 | — |
| 20 | جاهزية النشر + فحص نهائي | ✅ بعد 20 | ✅ **رابع اختبار محاكي (نهائي)** |

---

## نقاط اختبار المحاكي (تفصيل)

| بعد المرحلة | ما يُختبر |
|-------------|-----------|
| **٥** | فتح التطبيق → Splash → Login → (mock login حتى المرحلة ٧) → Shell → Dashboard. التحقق من ظهور القائمة/الشريط. |
| **١٠** | **تسجيل دخول حقيقي (من المرحلة ٧)** ثم كل الشاشات: Dashboard، Orders، Order Detail، Menu، Add/Edit Menu، Settings. التحقق من الفرونت اند والربط مع الباك اند على **بيانات حية**. |
| **١٥** | كل المسارات: Auth، Shell، Dashboard، Orders، Menu، Services، Side Orders (لـ popular_cooking)، Staff، Analytics، Settings. التحقق من رفع صورة/فيديو والربط الكامل. |
| **٢٠** | مسار كامل من البداية للنهاية مع بيانات حية؛ التأكد من عدم أخطاء، وجاهزية البناء للنشر. |

---

## الضمان بعد المرحلة ٢٠

- **التطبيق مكتمل:** كل الـ ٢٢ شاشة والـ Shell تعمل وتنقل سليم.
- **مربوط بالباك اند:** تسجيل دخول، بروفايل، طلبات، وجبات، خدمات، طلبات جانبية، موظفون، تحليلات، رفع وسائط.
- **تحليل نظيف:** `flutter analyze` بدون أخطاء أو تحذيرات (أو استثناءات موثقة).
- **جاهز للنشر:** إصدار محدث، نصوص مراجعة، أمان أساسي، واختبار محاكي نهائي ناجح.

---

**نهاية خارطة العشرين مرحلة.**
