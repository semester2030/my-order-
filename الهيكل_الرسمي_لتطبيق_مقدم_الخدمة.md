# الهيكل الرسمي لتطبيق مقدم الخدمة (Vendor App)

**الإصدار:** 1.0  
**التاريخ:** ٢٨ يناير ٢٠٢٦  
**المرجع:** ويب فيندر (vendor-web) — تحويل كامل إلى تطبيق Flutter.

---

## ١. مبادئ الهيكل

| المبدأ | الوصف |
|--------|--------|
| **Clean Architecture** | كل ميزة (module) مقسمة إلى: `data` ← `domain` ← `presentation`. |
| **مطابقة الويب** | كل صفحة في ويب فيندر لها شاشة واحدة في التطبيق؛ نفس الـ API. |
| **الفئة الديناميكية** | ظهور "الطلبات الجانبية" وغيرها حسب `providerCategory`. |
| **تسمية موحدة** | إنجليزي للملفات والمتغيرات؛ عربي للنصوص المعروضة (i18n لاحقاً). |

---

## ٢. هيكل المشروع على مستوى الجذر

```
vendor_app/
├── lib/
│   ├── main.dart
│   ├── app.dart
│   ├── core/                    # بنية تحتية مشتركة
│   ├── modules/                  # الميزات (كل ميزة = module)
│   └── shared/                   # مكونات/أنواع مشتركة بين modules
├── test/
├── assets/
│   ├── images/
│   ├── icons/
│   └── fonts/
├── android/
├── ios/
├── pubspec.yaml
└── analysis_options.yaml
```

---

## ٣. Core — البنية التحتية

```
lib/core/
├── config/
│   ├── app_constants.dart        # ثوابت عامة (أسماء، حدود، إلخ)
│   ├── env.dart                  # بيئة (baseUrl، إلخ)
│   └── flavor.dart               # إن وُجدت flavors (dev/staging/prod)
├── di/
│   ├── service_locator.dart      # تسجيل الاعتماديات
│   └── providers.dart            # Riverpod providers للمشترك
├── network/
│   ├── api_client.dart           # HTTP client (Dio) مع baseUrl
│   ├── endpoints.dart            # مرجع مسارات الـ API (مطابق vendor-web)
│   ├── network_exceptions.dart
│   └── interceptors/
│       ├── auth_interceptor.dart # إرفاق JWT + refresh عند 401
│       ├── error_interceptor.dart
│       └── logging_interceptor.dart
├── storage/
│   ├── secure_storage.dart       # تخزين التوكن (flutter_secure_storage)
│   ├── local_storage.dart        # تخزين محلي عادي إن لزم
│   └── storage_keys.dart
├── routing/
│   ├── app_router.dart           # GoRouter تعريف كل المسارات
│   ├── route_names.dart          # ثوابت المسارات
│   └── guards.dart               # حماية المسارات (تسجيل دخول مقدم)
├── errors/
│   ├── app_exception.dart
│   ├── failure.dart
│   ├── error_handler.dart
│   └── error_mapper.dart
├── theme/
│   ├── app_theme.dart
│   ├── design_system.dart        # ألوان، نصوص، مسافات، نصف قطر
│   ├── colors/
│   ├── typography/
│   ├── spacing/
│   └── ...
├── utils/
│   ├── logger.dart
│   ├── validators.dart
│   └── formatters.dart
└── widgets/                      # مكونات UI مشتركة
    ├── app_scaffold.dart
    ├── app_text_field.dart
    ├── primary_button.dart
    ├── loading_view.dart
    ├── empty_state.dart
    └── error_state.dart
```

---

## ٤. المسارات (Route Names) — مطابقة صفحات الويب

```dart
// lib/core/routing/route_names.dart

class RouteNames {
  RouteNames._();

  // Auth
  static const String splash = '/';
  static const String login = '/login';
  static const String register = '/register';

  // Main (Shell: Drawer أو Bottom Nav)
  static const String dashboard = '/dashboard';
  static const String orders = '/orders';
  static const String orderDetails = '/orders/:id';
  static const String menu = '/menu';
  static const String services = '/services';
  static const String sideOrders = '/side-orders';   // للطبخ الشعبي فقط
  static const String staff = '/staff';
  static const String analytics = '/analytics';
  static const String settings = '/settings';

  // تفاصيل / نماذج (من داخل الشاشات أو كشاشات منفصلة)
  static const String addMenuItem = '/menu/add';
  static const String editMenuItem = '/menu/:id/edit';
  static const String addService = '/services/add';
  static const String editService = '/services/:id/edit';
  static const String addStaff = '/staff/add';
  static const String editStaff = '/staff/:id/edit';
  static const String changePassword = '/settings/change-password';
}
```

---

## ٥. الهيكل حسب الوحدات (Modules)

كل وحدة تتبع: **data → domain → presentation**.

---

### ٥.١ وحدة Auth

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/auth/data/` | |
| | | `datasources/auth_remote_ds.dart` — login, logout, refresh |
| | | `models/login_request_dto.dart`, `login_response_dto.dart` |
| | | `repositories/auth_repo_impl.dart` |
| **domain** | `modules/auth/domain/` | |
| | | `entities/vendor_session.dart` (أو token + vendorId) |
| | | `repositories/auth_repo.dart` |
| **presentation** | `modules/auth/presentation/` | |
| | | `screens/splash_screen.dart` |
| | | `screens/login_screen.dart` |
| | | `screens/register_screen.dart` |
| | | `providers/auth_notifier.dart`, `auth_state.dart` |

---

### ٥.٢ وحدة Dashboard (لوحة التحكم)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/dashboard/data/` | |
| | | `datasources/analytics_remote_ds.dart` — استدعاء `/vendors/analytics` |
| | | `models/dashboard_stats_dto.dart` |
| | | `repositories/dashboard_repo_impl.dart` |
| **domain** | `modules/dashboard/domain/` | |
| | | `entities/dashboard_stats.dart` |
| | | `repositories/dashboard_repo.dart` |
| **presentation** | `modules/dashboard/presentation/` | |
| | | `screens/dashboard_screen.dart` |
| | | `providers/dashboard_notifier.dart`, `dashboard_state.dart` |
| | | `widgets/stat_card.dart`, `orders_summary_card.dart` |

---

### ٥.٣ وحدة Orders (الطلبات)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/orders/data/` | |
| | | `datasources/orders_remote_ds.dart` — list, detail, accept, reject, updateStatus |
| | | `models/order_dto.dart`, `order_item_dto.dart` |
| | | `mappers/orders_mapper.dart` |
| | | `repositories/orders_repo_impl.dart` |
| **domain** | `modules/orders/domain/` | |
| | | `entities/order.dart`, `order_item.dart` |
| | | `repositories/orders_repo.dart` |
| **presentation** | `modules/orders/presentation/` | |
| | | `screens/orders_screen.dart` — قائمة الطلبات + فلتر (حالة) |
| | | `screens/order_detail_screen.dart` — تفاصيل + أزرار قبول/رفض/تحديث الحالة |
| | | `providers/orders_notifier.dart`, `orders_state.dart` |
| | | `widgets/order_tile.dart`, `order_status_chip.dart`, `order_actions_bar.dart` |

---

### ٥.٤ وحدة Menu (الوجبات والخدمات — قائمة الوجبات/الأطباق)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/menu/data/` | |
| | | `datasources/menu_remote_ds.dart` — list, create, update, delete, toggleAvailability |
| | | `models/menu_item_dto.dart` |
| | | `mappers/menu_mapper.dart` |
| | | `repositories/menu_repo_impl.dart` |
| **domain** | `modules/menu/domain/` | |
| | | `entities/menu_item.dart` |
| | | `repositories/menu_repo.dart` |
| **presentation** | `modules/menu/presentation/` | |
| | | `screens/menu_screen.dart` — قائمة الوجبات + زر إضافة |
| | | `screens/add_menu_item_screen.dart` أو مودال (حسب التصميم) |
| | | `screens/edit_menu_item_screen.dart` |
| | | `providers/menu_notifier.dart`, `menu_state.dart` |
| | | `widgets/menu_item_tile.dart`, `availability_switch.dart` |

**ملاحظة:** نصوص "وجبة" vs "طبق وليمة" تُحدد حسب `profile.providerCategory == 'popular_cooking'` (من سياق البروفايل).

---

### ٥.٥ وحدة Services (ما أقدمه للزبائن)

نفس منطق الـ Menu من ناحية الـ API (نفس جدول menu_items أو نفس الـ endpoint حسب الباك اند). الفرق في الواجهة: عرض كـ "خدمات" مع إمكان ربط فيديو.

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | نفس مصدر الـ menu أو مشترك | يمكن مشاركة `menu_repo` مع تمييز نوع (وجبة vs خدمة) إن وُجد في الـ API. |
| **domain** | `modules/services/domain/` | `entities/service_item.dart` إن اختلف عن menu_item. |
| **presentation** | `modules/services/presentation/` | |
| | | `screens/services_screen.dart` |
| | | `screens/add_service_screen.dart`, `edit_service_screen.dart` |
| | | `providers/services_notifier.dart` |
| | | `widgets/service_item_tile.dart`, ربط فيديو (upload) |

---

### ٥.٦ وحدة Side Orders (الطلبات الجانبية — للطبخ الشعبي فقط)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/side_orders/data/` | |
| | | لا يوجد remote منفصل؛ التحديث عبر `vendors.updateProfile({ popularCookingAddOns })`. |
| | | استخدام `VendorProfileRepo` أو `ProfileRemoteDs` الذي يستدعي GET/PUT profile. |
| **domain** | `modules/side_orders/domain/` | |
| | | `entities/side_order_item.dart` (name, price). |
| **presentation** | `modules/side_orders/presentation/` | |
| | | `screens/side_orders_screen.dart` — قائمة إضافة/تعديل/حذف (جريش، قرصان، إدامات…) |
| | | `providers/side_orders_notifier.dart` — يقرأ من profile، يكتب عبر updateProfile. |
| | | `widgets/side_order_tile.dart`, `add_side_order_form.dart` |

**ظهور في التنقل:** فقط عندما `profile?.providerCategory == 'popular_cooking'`.

---

### ٥.٧ وحدة Staff (الموظفون)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/staff/data/` | |
| | | `datasources/staff_remote_ds.dart` — list, create, update, delete |
| | | `models/staff_member_dto.dart` |
| | | `mappers/staff_mapper.dart` |
| | | `repositories/staff_repo_impl.dart` |
| **domain** | `modules/staff/domain/` | |
| | | `entities/staff_member.dart` |
| | | `repositories/staff_repo.dart` |
| **presentation** | `modules/staff/presentation/` | |
| | | `screens/staff_screen.dart` |
| | | `screens/add_staff_screen.dart`, `edit_staff_screen.dart` |
| | | `providers/staff_notifier.dart`, `staff_state.dart` |
| | | `widgets/staff_tile.dart` |

---

### ٥.٨ وحدة Analytics (التحليلات)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/analytics/data/` | |
| | | `datasources/analytics_remote_ds.dart` — GET `/vendors/analytics` |
| | | `models/analytics_dto.dart` |
| | | `repositories/analytics_repo_impl.dart` |
| **domain** | `modules/analytics/domain/` | |
| | | `entities/analytics_snapshot.dart` |
| | | `repositories/analytics_repo.dart` |
| **presentation** | `modules/analytics/presentation/` | |
| | | `screens/analytics_screen.dart` — رسوم/أرقام حسب الـ API |
| | | `providers/analytics_notifier.dart` |
| | | `widgets/chart_card.dart`, `metric_row.dart` |

---

### ٥.٩ وحدة Profile / Settings (البروفايل والإعدادات)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/profile/data/` | |
| | | `datasources/profile_remote_ds.dart` — getProfile, updateProfile, changePassword |
| | | `models/vendor_profile_dto.dart` (يضم popularCookingAddOns، providerCategory، إلخ) |
| | | `repositories/profile_repo_impl.dart` |
| **domain** | `modules/profile/domain/` | |
| | | `entities/vendor_profile.dart` |
| | | `repositories/profile_repo.dart` |
| **presentation** | `modules/profile/presentation/` | |
| | | `screens/settings_screen.dart` — قائمة: البروفايل، تغيير كلمة المرور، خروج |
| | | `screens/edit_profile_screen.dart` |
| | | `screens/change_password_screen.dart` |
| | | `providers/profile_notifier.dart` — يحمّل البروفايل ويوفره لباقي التطبيق (للفئة والطلبات الجانبية) |
| | | `widgets/profile_header.dart`, `settings_tile.dart` |

---

### ٥.١٠ وحدة Videos (رفع الفيديو للوجبات/الخدمات)

| الطبقة | المسار | الملفات الأساسية |
|--------|--------|-------------------|
| **data** | `modules/videos/data/` | |
| | | `datasources/videos_remote_ds.dart` — init, complete, upload (حسب endpoints الويب) |
| | | `repositories/videos_repo_impl.dart` |
| **domain** | `modules/videos/domain/` | |
| | | `repositories/videos_repo.dart` |
| **presentation** | استخدام من داخل Menu/Services | |
| | | `widgets/video_picker.dart` أو شاشة رفع مخصصة تستدعي repo. |

---

## ٦. التنقل (Navigation) — الهيكل الرسمي

### ٦.١ بعد تسجيل الدخول: Shell

- **Shell** = إما **Scaffold + Drawer** أو **Scaffold + BottomNavigationBar**.
- العناصر الأساسية (مطابقة سايدبار الويب):

| الترتيب | العنصر | المسار | أيقونة مقترحة |
|---------|--------|--------|----------------|
| 1 | لوحة التحكم | `/dashboard` | LayoutDashboard |
| 2 | الطلبات | `/orders` | ShoppingBag |
| 3 | الوجبات والخدمات | `/menu` | Utensils |
| 4 | ما أقدمه للزبائن | `/services` | ClipboardList |
| 5 | الطلبات الجانبية | `/side-orders` | ListChecks — **يظهر فقط إذا** `providerCategory == 'popular_cooking'` |
| 6 | الموظفون | `/staff` | Users |
| 7 | التحليلات | `/analytics` | BarChart3 |
| 8 | الإعدادات | `/settings` | Settings |

- **الرأس (AppBar):** عنوان الشاشة الحالية + أيقونة القائمة (Drawer) أو عدم إظهار قائمة إذا استخدمتم Bottom Nav فقط.
- **خيار Drawer:** في نهاية القائمة زر "تسجيل الخروج" يستدعي logout ثم إعادة توجيه إلى `/login`.

### ٦.٢ مسار المستخدم (بدون تسجيل دخول)

```
splash (/) → إن لم يكن مسجلاً → login (/login)
login → register (/register) إن ضغط "إنشاء حساب"
login (ناجح) → dashboard (/dashboard) أو أول عنصر في الـ Shell
```

### ٦.٣ مسار المستخدم (بعد تسجيل الدخول)

```
Shell (أول شاشة = dashboard)
  ├── dashboard
  ├── orders → orderDetails (/orders/:id)
  ├── menu → addMenuItem / editMenuItem
  ├── services → addService / editService
  ├── side-orders (إن كانت الفئة popular_cooking)
  ├── staff → addStaff / editStaff
  ├── analytics
  └── settings → editProfile / changePassword
```

---

## ٧. Endpoints — مرجع API (مطابق ويب فيندر)

```dart
// lib/core/network/endpoints.dart

class Endpoints {
  Endpoints._();

  static const String baseUrl = 'BASE_URL'; // من env

  // Auth
  static const String authVendorLogin = '/auth/vendor/login';
  static const String authLogout = '/auth/logout';
  static const String authRefresh = '/auth/refresh';

  // Vendors
  static const String vendorsRegister = '/vendors/register';
  static const String vendorsProfile = '/vendors/profile';
  static const String vendorsChangePassword = '/vendors/change-password';

  // Orders
  static const String vendorsOrders = '/vendors/orders';
  static String vendorOrderDetail(String id) => '/vendors/orders/$id';
  static String vendorOrderAccept(String id) => '/vendors/orders/$id/accept';
  static String vendorOrderReject(String id) => '/vendors/orders/$id/reject';
  static String vendorOrderStatus(String id) => '/vendors/orders/$id/status';

  // Menu
  static const String vendorsMenu = '/vendors/menu';
  static String vendorMenuItem(String id) => '/vendors/menu/$id';
  static String vendorMenuItemAvailability(String id) => '/vendors/menu/$id/availability';

  // Staff
  static const String vendorsStaff = '/vendors/staff';
  static String vendorStaffMember(String id) => '/vendors/staff/$id';

  // Analytics
  static const String vendorsAnalytics = '/vendors/analytics';

  // Videos
  static const String videosUploadInit = '/videos/upload/init';
  static const String videosUploadComplete = '/videos/upload/complete';
  static String videosUpload(String menuItemId) => '/videos/upload/$menuItemId';
}
```

---

## ٨. تسمية الملفات والمتغيرات

| النوع | القاعدة | مثال |
|-------|---------|------|
| ملفات Dart | snake_case | `order_detail_screen.dart`, `auth_remote_ds.dart` |
| كلاسات | PascalCase | `OrderDetailScreen`, `AuthRemoteDs` |
| دوال ومتغيرات | camelCase | `loadOrders`, `isPopularCooking` |
| ثوابت (const) | camelCase أو lowerCamelCase | `routeNames`, `kDefaultPadding` |
| مسارات | snake_case في route_names | `orderDetails` = `/orders/:id` |
| مجلدات | snake_case | `side_orders`, `order_detail` |

---

## ٩. الاعتماديات بين الطبقات

```
presentation  →  domain  →  data
     │              │          │
     │              │          └── api_client, endpoints, dtos, mappers
     │              └── entities, repositories (interfaces)
     └── screens, widgets, providers (state)
```

- **domain** لا يعتمد على **data** ولا على **presentation**.
- **data** يعتمد على **domain** (entities) وعلى **core/network**.
- **presentation** يعتمد على **domain** ويمكنه استخدام **core/theme**, **core/widgets**.

---

## ١٠. ملخص الشاشات والوحدات

| # | الشاشة | الوحدة | مسار | ملاحظة |
|---|--------|--------|------|--------|
| 1 | Splash | auth | `/` | |
| 2 | Login | auth | `/login` | |
| 3 | Register | auth | `/register` | فئة الخدمة + الطلبات الجانبية للطبخ الشعبي |
| 4 | Dashboard | dashboard | `/dashboard` | |
| 5 | Orders | orders | `/orders` | |
| 6 | Order Detail | orders | `/orders/:id` | |
| 7 | Menu | menu | `/menu` | |
| 8 | Add/Edit Menu Item | menu | `/menu/add`, `/menu/:id/edit` | |
| 9 | Services | services | `/services` | |
| 10 | Add/Edit Service | services | `/services/add`, `/services/:id/edit` | |
| 11 | Side Orders | side_orders | `/side-orders` | للطبخ الشعبي فقط |
| 12 | Staff | staff | `/staff` | |
| 13 | Add/Edit Staff | staff | `/staff/add`, `/staff/:id/edit` | |
| 14 | Analytics | analytics | `/analytics` | |
| 15 | Settings | profile | `/settings` | |
| 16 | Edit Profile | profile | من الإعدادات | |
| 17 | Change Password | profile | من الإعدادات | |

---

## ١١. شجرة المجلدات النهائية (ملخص)

```
lib/
├── main.dart
├── app.dart
├── core/
│   ├── config/
│   ├── di/
│   ├── network/
│   ├── storage/
│   ├── routing/
│   ├── errors/
│   ├── theme/
│   ├── utils/
│   └── widgets/
├── modules/
│   ├── auth/
│   │   ├── data/
│   │   ├── domain/
│   │   └── presentation/
│   ├── dashboard/
│   ├── orders/
│   ├── menu/
│   ├── services/
│   ├── side_orders/
│   ├── staff/
│   ├── analytics/
│   ├── profile/
│   └── videos/
└── shared/
    ├── enums/
    │   ├── provider_category.dart
    │   └── order_status.dart
    └── extensions/
```

---

**نهاية الهيكل الرسمي.**  
هذا الهيكل جاهز للاستخدام كمرجع تنفيذي لتطبيق مقدم الخدمة بمطابقة تامة مع ويب فيندر والـ API الحالي.
